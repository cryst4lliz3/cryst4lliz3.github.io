![](/images/malware-traffic-analysis-1-pcap/1.png)

This is the write-up of [Malware Traffic Analysis 1 — PCAP](https://cyberdefenders.org/labs/17) by [Brad Duncan](https://twitter.com/malware_traffic) on [CyberDefenders](https://cyberdefenders.org/).

![](/images/malware-traffic-analysis-1-pcap/2.png)

Given a PCAP file named mta1.pcap which containing 3053 packets. I need to answer the following questions based on the PCAP file:

* What is the IP address of the Windows VM that gets infected?
* What is the host name of the Windows VM that gets infected?
* What is the MAC address of the infected VM?
* What is the IP address of the compromised web site?
* What is the domain name of the compromised web site?
* What is IP address of the server that delivered the exploit kit and malware?
* What is the domain name that delivered the exploit kit and malware?
* What is the redirect URL that points to the exploit kit (EK) landing page?
* Other than CVE-2013–2551 IE exploit, what other exploit(s) sent by the EK?
* How many times was the payload delivered?
* What are the SIDs of the triggered Snort alerts?
* The compromised website has the malicious script with a URL. What is this URL?
* Extract the exploit file(s). What is (are) the MD5 file hash(es)?
* VirusTotal doesn’t show how many times a specific rule was fired under the “Suricata alerts” section for the pcap analysis. Run the pcap file against your local Suricata (Emerging Threats Open ruleset) and provide the rule number that was fired the most.

First thing to do is to have an overview of what network traffic is present in a PCAP file. To do this go to **Statistics > Protocol Hierarchy**. This provides a good overview of different protocols that are present. This can also help identify any abnormal protocol activity that might stick out.

![](/images/malware-traffic-analysis-1-pcap/3.png)

From the **Protocol Hierarchy**, I see some **HTTP (Hypertext Transfer Protocol)** activity, so I will filter this in **Wireshark** to view **HTTP** traffic.

![](/images/malware-traffic-analysis-1-pcap/4.png)

The source of all traffic is **172.16.165.165**. Therefore, I can assume that this is the infected VM.

> What is the IP address of the Windows VM that gets infected?
> 
> 172.16.165.165

![](/images/malware-traffic-analysis-1-pcap/5.png)

To know the host name of the Windows VM that gets infected, I use **bootp** filter in Wireshark to display DHCP traffic and view more information on the infected host (**172.16.165.165**). The screenshot above shows the MAC address and host name of the infected host.

> What is the host name of the Windows VM that gets infected? 
> 
> K34EN6W3N-PC

> What is the MAC address of the infected VM? 
> 
> f0:19:af:02:9b:f1

From the output of display filter **http.request**, it can be seen that the infected host communicates with the following remote domains:

* bing.com
* ciniholland.nl
* adultbiz.in
* ytimg.l.google.com (don’t know what is this domain)
* 24corp-shop.com
* stand.trustandprobaterealty.com

The user lands on www.ciniholland.nl through a Bing search result. This is evident from the Referer field in the HTTP header.

![](/images/malware-traffic-analysis-1-pcap/6.png)

When inspect the source code of **ciniholland.nl/index.html**, there is an invisible iframe being created in line 59 with source URL **24corp-shop.com**. This suggests that the website **www.ciniholland.nl** (IP address: **82.150.140.30**) is compromised.

![](/images/malware-traffic-analysis-1-pcap/7.png)

> What is the IP address of the compromised web site? 
> 
> 82.150.140.30

> What is the domain name of the compromised web site? 
> 
> www.ciniholland.nl

I follow the GET requests using **http.request.method** filter and see that the final website initiates downloads on the now compromised machine. Its IP address is **37.200.69.143**.

![](/images/malware-traffic-analysis-1-pcap/8.png)

> What is IP address of the server that delivered the exploit kit and malware? 
> 
> 37.200.69.143

> What is the domain name that delivered the exploit kit and malware? 
> 
> stand.trustandprobaterealty.com

![](/images/malware-traffic-analysis-1-pcap/9.png)

As I checked the GET request , I found out that the referer to the first EK landing page (stand.trustandprobaterealty.com) was **24corp-shop.com**.

> What is the redirect URL that points to the exploit kit (EK) landing page? 
> 
> 24corp-shop.com

![](/images/malware-traffic-analysis-1-pcap/10.png)

By checking the the HTML object (**File > Export Object > HTTP**), I can see two other exploits which are Flash and Java.

> Other than CVE-2013–2551 IE exploit, what other exploit(s) sent by the EK? 
> 
> flash,java

![](/images/malware-traffic-analysis-1-pcap/11.png)

Referring to the **application/x-msdownload**, it being delivered 3 times.

> How many times was the payload delivered? 
> 
> 3

I uploaded the PCAP file to **VirusTotal** and check the **Snort Alerts**. Here’s what I found.

![](/images/malware-traffic-analysis-1-pcap/12.png)

> What are the SIDs of the triggered Snort alerts? 
> 
> 25562,27816,30934,30936

> The compromised website has the malicious script with a URL. What is this URL? 
> 
> 24corp-shop.com

I extract the both exploit files which are flash and java and check their MD5 file hash using **md5sum**.

![](/images/malware-traffic-analysis-1-pcap/13.png)

> Extract the exploit file(s). What is (are) the MD5 file hash(es)? 
> 
> 7b3baa7d6bb3720f369219789e38d6ab,1e34fdebbf655cebea78b45e43520ddf

![](/images/malware-traffic-analysis-1-pcap/14.png)

Based on the Suricata Alerts, there is 1 rule that alerted 3 times (**ET CURRENT_EVENTS GoonEK encrypted binary**).

> VirusTotal doesn’t show how many times a specific rule was fired under the “Suricata alerts” section for the pcap analysis. Run the pcap file against your local Suricata (Emerging Threats Open ruleset) and provide the rule number that was fired the most. 
> 
> 2018297