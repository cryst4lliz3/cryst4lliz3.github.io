
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="newbie in cybersec">
      
      
      
      
        <meta name="author" content="Ahmad A'fif">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>Malware Traffic Analysis 1 - PCAP - Cryst4lliz3</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-183966884-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Cryst4lliz3" class="md-header-nav__button md-logo" aria-label="Cryst4lliz3">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Cryst4lliz3
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Malware Traffic Analysis 1 - PCAP
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cryst4lliz3" class="md-nav__button md-logo" aria-label="Cryst4lliz3">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Cryst4lliz3
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    <label class="md-nav__link" for="nav-2">
      Write-up
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Write-up" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Write-up
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" >
    <label class="md-nav__link" for="nav-2-1">
      Basic Malware Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Basic Malware Analysis" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon"></span>
        Basic Malware Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../basic-malware-analysis-chake-berberian-order/" class="md-nav__link">
      Chake Berberian Order.exe
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" >
    <label class="md-nav__link" for="nav-2-2">
      CTF Intern
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="CTF Intern" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon"></span>
        CTF Intern
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ctf-round-3-active-directory/" class="md-nav__link">
      CTF Round 3 - Active Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" checked>
    <label class="md-nav__link" for="nav-2-3">
      CyberDefenders
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="CyberDefenders" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon"></span>
        CyberDefenders
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Malware Traffic Analysis 1 - PCAP
    </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Malware Traffic Analysis 1 - PCAP</h1>
                
                <p><img alt="" src="/images/malware-traffic-analysis-1-pcap/1.png" /></p>
<p>This is the write-up of <a href="https://cyberdefenders.org/labs/17">Malware Traffic Analysis 1 — PCAP</a> by <a href="https://twitter.com/malware_traffic">Brad Duncan</a> on <a href="https://cyberdefenders.org/">CyberDefenders</a>.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/2.png" /></p>
<p>Given a PCAP file named mta1.pcap which containing 3053 packets. I need to answer the following questions based on the PCAP file:</p>
<ul>
<li>What is the IP address of the Windows VM that gets infected?</li>
<li>What is the host name of the Windows VM that gets infected?</li>
<li>What is the MAC address of the infected VM?</li>
<li>What is the IP address of the compromised web site?</li>
<li>What is the domain name of the compromised web site?</li>
<li>What is IP address of the server that delivered the exploit kit and malware?</li>
<li>What is the domain name that delivered the exploit kit and malware?</li>
<li>What is the redirect URL that points to the exploit kit (EK) landing page?</li>
<li>Other than CVE-2013–2551 IE exploit, what other exploit(s) sent by the EK?</li>
<li>How many times was the payload delivered?</li>
<li>What are the SIDs of the triggered Snort alerts?</li>
<li>The compromised website has the malicious script with a URL. What is this URL?</li>
<li>Extract the exploit file(s). What is (are) the MD5 file hash(es)?</li>
<li>VirusTotal doesn’t show how many times a specific rule was fired under the “Suricata alerts” section for the pcap analysis. Run the pcap file against your local Suricata (Emerging Threats Open ruleset) and provide the rule number that was fired the most.</li>
</ul>
<p>First thing to do is to have an overview of what network traffic is present in a PCAP file. To do this go to <strong>Statistics &gt; Protocol Hierarchy</strong>. This provides a good overview of different protocols that are present. This can also help identify any abnormal protocol activity that might stick out.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/3.png" /></p>
<p>From the <strong>Protocol Hierarchy</strong>, I see some <strong>HTTP (Hypertext Transfer Protocol)</strong> activity, so I will filter this in <strong>Wireshark</strong> to view <strong>HTTP</strong> traffic.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/4.png" /></p>
<p>The source of all traffic is <strong>172.16.165.165</strong>. Therefore, I can assume that this is the infected VM.</p>
<blockquote>
<p>What is the IP address of the Windows VM that gets infected?</p>
<p>172.16.165.165</p>
</blockquote>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/5.png" /></p>
<p>To know the host name of the Windows VM that gets infected, I use <strong>bootp</strong> filter in Wireshark to display DHCP traffic and view more information on the infected host (<strong>172.16.165.165</strong>). The screenshot above shows the MAC address and host name of the infected host.</p>
<blockquote>
<p>What is the host name of the Windows VM that gets infected? </p>
<p>K34EN6W3N-PC</p>
<p>What is the MAC address of the infected VM? </p>
<p>f0:19:af:02:9b:f1</p>
</blockquote>
<p>From the output of display filter <strong>http.request</strong>, it can be seen that the infected host communicates with the following remote domains:</p>
<ul>
<li>bing.com</li>
<li>ciniholland.nl</li>
<li>adultbiz.in</li>
<li>ytimg.l.google.com (don’t know what is this domain)</li>
<li>24corp-shop.com</li>
<li>stand.trustandprobaterealty.com</li>
</ul>
<p>The user lands on www.ciniholland.nl through a Bing search result. This is evident from the Referer field in the HTTP header.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/6.png" /></p>
<p>When inspect the source code of <strong>ciniholland.nl/index.html</strong>, there is an invisible iframe being created in line 59 with source URL <strong>24corp-shop.com</strong>. This suggests that the website <strong>www.ciniholland.nl</strong> (IP address: <strong>82.150.140.30</strong>) is compromised.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/7.png" /></p>
<blockquote>
<p>What is the IP address of the compromised web site? </p>
<p>82.150.140.30</p>
<p>What is the domain name of the compromised web site? </p>
<p>www.ciniholland.nl</p>
</blockquote>
<p>I follow the GET requests using <strong>http.request.method</strong> filter and see that the final website initiates downloads on the now compromised machine. Its IP address is <strong>37.200.69.143</strong>.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/8.png" /></p>
<blockquote>
<p>What is IP address of the server that delivered the exploit kit and malware? </p>
<p>37.200.69.143</p>
<p>What is the domain name that delivered the exploit kit and malware? </p>
<p>stand.trustandprobaterealty.com</p>
</blockquote>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/9.png" /></p>
<p>As I checked the GET request , I found out that the referer to the first EK landing page (stand.trustandprobaterealty.com) was <strong>24corp-shop.com</strong>.</p>
<blockquote>
<p>What is the redirect URL that points to the exploit kit (EK) landing page? </p>
<p>24corp-shop.com</p>
</blockquote>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/10.png" /></p>
<p>By checking the the HTML object (<strong>File &gt; Export Object &gt; HTTP</strong>), I can see two other exploits which are Flash and Java.</p>
<blockquote>
<p>Other than CVE-2013–2551 IE exploit, what other exploit(s) sent by the EK? </p>
<p>flash,java</p>
</blockquote>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/11.png" /></p>
<p>Referring to the <strong>application/x-msdownload</strong>, it being delivered 3 times.</p>
<blockquote>
<p>How many times was the payload delivered? </p>
<p>3</p>
</blockquote>
<p>I uploaded the PCAP file to <strong>VirusTotal</strong> and check the <strong>Snort Alerts</strong>. Here’s what I found.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/12.png" /></p>
<blockquote>
<p>What are the SIDs of the triggered Snort alerts? </p>
<p>25562,27816,30934,30936</p>
<p>The compromised website has the malicious script with a URL. What is this URL? </p>
<p>24corp-shop.com</p>
</blockquote>
<p>I extract the both exploit files which are flash and java and check their MD5 file hash using <strong>md5sum</strong>.</p>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/13.png" /></p>
<blockquote>
<p>Extract the exploit file(s). What is (are) the MD5 file hash(es)? </p>
<p>7b3baa7d6bb3720f369219789e38d6ab,1e34fdebbf655cebea78b45e43520ddf</p>
</blockquote>
<p><img alt="" src="/images/malware-traffic-analysis-1-pcap/14.png" /></p>
<p>Based on the Suricata Alerts, there is 1 rule that alerted 3 times (<strong>ET CURRENT_EVENTS GoonEK encrypted binary</strong>).</p>
<blockquote>
<p>VirusTotal doesn’t show how many times a specific rule was fired under the “Suricata alerts” section for the pcap analysis. Run the pcap file against your local Suricata (Emerging Threats Open ruleset) and provide the rule number that was fired the most. </p>
<p>2018297</p>
</blockquote>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../ctf-round-3-active-directory/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                CTF Round 3 - Active Directory
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>